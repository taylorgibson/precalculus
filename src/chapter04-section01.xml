<?xml version="1.0" encoding="UTF-8" ?>

<!-- This file is part of the book                      -->
<!--                                                    -->
<!--   Contemporary Pre-Calculus Through Applications   -->
<!--                                                    -->
<!-- Copyright (C) 2017  Mathematics Department, NCSSM  -->
<!-- See the file COPYING for copying conditions.       -->
<section xml:id="chapter04-section01" xmlns:xi="http://www.w3.org/2001/XInclude">
  <title>Recursive Functions</title>
  <p>In a previous chapter we learned that a function is a special sets of ordered pairs.  In most of the examples in the preceeding chapters, functions were described by an algebraic expression that could be evaluated for a particular input value resulting in a unique output value. Such algebraic expressions are called closed form or explicit expressions.  For these functions, the relationship <m>y=f(x)</m> is used to show how the <m>y</m>-value is related to the given <m>x</m>-value. For example, the function <m>f(x)=x^2+6x</m> is an explicit function. This notation tells us that any particular numerical value for <m>x</m> is paired with the <m>y</m>-value equal to <m>x^2+6x</m>. So 1 is paired with 7, since <m>f(1)=(1)^2+6(1)=7</m> , and <m>-3</m> is paired with <m>-9</m>, since <m>f(-3)=(-3)^2+6(-3)=-9</m>.</p>
  <p>In this section we will investigate functions that are defined recursively. The domain values for these functions are positive whole numbers, and each range value is defined in terms of the preceding range value, rather than in terms of an <m>x</m>-value.</p>
  <example xml:id="ibuprofen-example-one-dose">
    <title>Ibuprofen in the blood stream</title>
    <statement>
      <p>Joan has a headache and decides to take a 200mg ibuprofen tablet for pain relief.  The drug is absorbed into her system and stays in her system until the drug is metabolized and filtered out by the liver and kidneys.  Ibuprofen is rapidly metabolized.  Every four hours, Joan's body removes <m>67\%</m> of the ibuprofen that was in her body at the beginning of that four-hour time period.  How much of the ibuprofen will remain in her system <m>24</m> hours after taking the <m>200</m>mg tablet?</p>
    </statement>
    <solution>
      <statement>
        <p>One way to generate values for the amount of ibuprofen in Joan's system is to use an iterative process.  In any iterative process the current value of a variable is used to determine the next value.  In this example, we generate a new amount of ibuprofen by subtracting the amount of ibuprofen filtered out of Joan's system from the amount that was previously there.  Since Joan begins with 200mg of ibuprofen, we write
          <md>
            <mrow>D_0 = 200</mrow>
          </md>
          where <m>D_0</m> is used to represent the amount of ibuprofen present at the start of the process</p>
          <p>We will use <m>D_1</m> to represent the amount of ibuprofen left after four hours.  The subscripts are used to count the steps, or iterations,  in the iterative process. In this problem the subscript  represents the number of four-hour time periods since Joan took the tablet.  In four hours, her kidneys have filtered out <m>67\%</m> of the drug from her bloodstream, so we write
          <md>
            <mrow>D_1=D_0-.67D_0=200-.67 \cdot 200 = 66</mrow>
          </md></p>
          <p>The amount of drug in her body after a second four-hour time period is represented by <m>D_2</m>.
          <md>
            <mrow>D_2=D_1-0.67D_1=66-.067 \cdot 66 = 21.78</mrow>
          </md></p>
          <p>Similarly, we know that successive values of the amount of drug in her body can be generated by
            <md>
              <mrow>D_3 \amp = D_2-0.67D_2 = 7.187</mrow>
              <mrow>D_4 \amp = D_3-0.67D_3 = 2.372</mrow>
            </md>
            and, in general,
            <md>
              <mrow>D_n=D_{n-1}-0.67D_{n-1},n=1,2,3...</mrow>
            </md></p>
            <p>Using a spreadsheet or calculator, we can generate successive values of <m>D_n</m> as shown in <xref ref="figure-ibuprofen-one-dose" text="type-local" />.  Note that values in the table are rounded to three decimal places but that exact values were used in all computations. The amount of drug in Joan's body drops to less than <m>1</m> mg between the fourth and fifth time periods.  If she takes a single <m>200</m> mg dose, Joan will have only about <m>0.258</m> mg remaining in her body <m>24</m> hours later.</p>
            <figure xml:id="figure-ibuprofen-one-dose">
              <caption>Amount of drug in Joan's body (Single 200 mg dose)</caption>
              <sidebyside widths ="20% 65%">
                <image xml:id="table-ibuprofen-one-dose">
                  <latex-image-code>
                    <![CDATA[
                    \pgfplotstabletypeset[
                    col sep=comma,
                    column type=l,
                    every head row/.style={after row=\hline},
                    every column/.style={column type/.add={|}{|}},
                    every first column/.style={column type/.add={}{|}},
                    columns/0/.style={string type, column name={$n$}},
                    columns/1/.style={string type, column name={$D_n$}},
                    ]{data-single-dose-ibuprofen.csv}
                    ]]>
                  </latex-image-code>
                </image>
                <!-- -->
                <image xml:id="plot-ibuprofen-one-dose">
                  <description>Amount of drug in Joan's body (Single 200 mg dose)</description>
                  <latex-image-code>
                    <!-- CDATA prevents certain LaTeX code from being interpreted as xml -->
                    <![CDATA[
                    \begin{tikzpicture}
                    \begin{axis}[
                    axis line style = {<->},
                    width = 0.5\linewidth,
                    xlabel = Number of 4 hour intervals,
                    ylabel = Amount of Ibuprofen (mg),
                    label style={font=\tiny},
                    xmin = -1, xmax= 7,
                    ymin = -25, ymax=250,
                    ytick = {0,100,200},
                    xtick = {0, 1, ...,6},
                    tick label style={font=\tiny},
                    ]
                    \addplot table [only marks, x index = {0}, y index = {1}, col sep=comma]{data-single-dose-ibuprofen.csv};
                    \end{axis}
                    \end{tikzpicture}]]>
                  </latex-image-code>
                </image>
              </sidebyside>
            </figure>
            <p>The graph in <xref ref="figure-ibuprofen-one-dose" text="type-local" /> shows the ordered pairs <m>(n,D_n)</m> generated by the recursive system</p>
            <md>
              <mrow>D_0=200</mrow>
              <mrow>D_n=D_{n-1} - 0.67D_{n-1}, n=1,2,3,...</mrow>
            </md>
            <p>Each point on the graph shows the amount of ibuprofen in Joan’s body at the end of a four-hour time period. Notice that there is obvious curvature in this graph.  The amount of drug in Joan’s body does not decrease by the same number of milligrams during each time interval.</p>
          </statement>
        </solution>
      </example>
      <!-- <p>You should complete Practice Problems 1 and 2 now.</p> -->

      <exercises>
        <title>Class Practice</title>
        <exercise xml:id="chapter04-section01-initial-ibuprofen-exercise">
          <statement>
            <p>Modify the recursive system used in <xref ref="ibuprofen-example-one-dose" text="type-local" /> as appropriate to answer the following questions:
            <ol>
              <li>Suppose Joan takes tablets that contain <m>250</m> milligrams of ibuprofen. How much ibuprofen would be in her body after <m>4, 8, 12, 16, 20,</m> and <m>24</m> hours?</li>
              <li>Suppose Joan's kidneys filter only <m>50\%</m> of the drug in a four hour time period.  If Joan takes a <m>200</m> mg tablet every <m>4</m> hours, how much ibuprofen would she have in her system after <m>4, 8, 12, 16, 20,</m> and <m>24</m> hours?</li>
            </ol>
          </p>
        </statement>
      </exercise>

      <exercise>
        <statement>
          <p>In each recursive system, the domain of <m>D_n</m> is <m>n=1,2,3, ...</m> and <m>D_n</m> represents the amount of ibuprofen in Joan's system after n four-hour time periods.  For each system, find how much drug remains after <m>24</m> hours, and identify the rate at which Joan's system filters out the drug.
          <ol>
            <li><m>D_0=300, D_n=D_{n-1} - 0.8D_{n-1}</m></li>
            <li><m>D_0=150, D_n=D_{n-1} - 0.2D_{n-1}</m></li>
            <li><m>D_0=500, D_n=0.2D_{n-1}</m></li>
            <li><m>D_0=500, D_n=0.5D_{n-1}</m></li>
          </ol>
        </p>
      </statement>
    </exercise>
  </exercises>

  <example>
    <title>Repated dose of ibuprofen</title>
    <statement>
      <p>Joan strained her knee playing tennis and her doctor has prescribed ibuprofen to reduce the inflammation and control pain.  Joan is instructed to take two 200-milligram ibuprofen tablets every 4 hours for three days.  Joan doesn’t like taking medicine, so she decides to take only one tablet every four hours for six days.  After the six days, Joan’s knee has not responded to the medication.  Naturally, she knew that the knee would take longer to respond to the reduced treatment, but she did not expect no response at all.  What could have happened?</p>
    </statement>
    <solution>
      <statement>
        <p>In this situation, Joan did not take just a single 200 mg tablet.  Every four hours she took another 200 mg tablet, and we can modify our recursive system to model this behavior. At the end of the nth four-hour period, Joan’s body has filtered <m>67\%</m> of the drug that was in her body after n-1st  four-hour period.  In addition, 200 mg from the new tablet have been added into her body.  The recursive system representing the amount of ibuprofen in Joan’s body if she takes one tablet every four hours is</p>
        <md>
          <mrow>D_0=200</mrow>
          <mrow>D_n=D_{n-1} - 0.67D_{n-1} + 200, n=1,2,3,...</mrow>
        </md>
        <p>The subscript n represents the number of four-hour time periods that have elapsed since Joan took the first dose.  By iterating the recursive system we can generate values of <m>D_n</m> that represent the amounts of drug in Joan’s body at the end of each four-hour period, assuming  <m>67\%</m> of the drug is filtered in a four-hour period.  These values, rounded to two decimal places, are shown together with a graph in <xref ref="figure-ibuprofen-multi-dose" text="type-local" /></p>
        <figure xml:id="figure-ibuprofen-multi-dose">
          <caption>Amount of drug in Joan's body (Reoccuring 200 mg doses)</caption>
          <sidebyside widths ="20% 65%">
            <image>
              <description>Table showing amount of drug in Joan's body</description>
              <latex-image-code>
                <![CDATA[
                \pgfplotstabletypeset[
                col sep=comma,
                column type=l,
                every head row/.style={after row=\hline},
                every column/.style={column type/.add={|}{|}},
                every first column/.style={column type/.add={}{|}},
                columns/0/.style={string type, column name={$n$}},
                columns/1/.style={string type, column name={$D_n$}},
                ]{data-multi-dose-ibuprofen.csv}
                ]]>
              </latex-image-code>
            </image>

            <!-- -->
            <image>
              <description>Plot of data showing amount of drug in Joan's body</description>
              <latex-image-code>
                <!-- CDATA prevents certain LaTeX code from being interpreted as xml -->
                <![CDATA[
                \begin{tikzpicture}
                \begin{axis}[
                axis line style = {<->},
                width = 0.5\linewidth,
                xlabel = Number of 4 hour intervals,
                ylabel = Amount of Ibuprofen (mg),
                label style={font=\tiny},
                xmin = -1.5, xmax= 11,
                ymin = -30, ymax=350,
                ytick = {0,100,200,300},
                xtick = {0, 1, ...,10},
                tick label style={font=\tiny},
                ]
                \addplot table [only marks, x index = {0}, y index = {1}, col sep=comma]{data-multi-dose-ibuprofen.csv};
                \end{axis}
                \end{tikzpicture}]]>
              </latex-image-code>
            </image>
          </sidebyside>
        </figure>

        <p>The points shown in <xref ref="figure-ibuprofen-multi-dose" text="type-local"/> represent the amount of the drug in Joan’s body immediately after she takes a tablet.  Between consecutrive doses, we know that the level of the drug declines.  We assume that the level “jumps up” at the moment she takes another tablet, and the recursive system enables us to compute these values.   If we  record the drug levels only after she takes a tablet, then we see that these values reach an equilibrium of approximately 298.51 mg.  To see why this equilibrium has been reached, consider how much of the 298.51 mg of the drug will be filtered in four hours.  Joan’s kidneys will filter out <m>67\%</m> of the 298.51 mg in her body, or approximately 200 mg, which will be replaced when she takes the next tablet. Equilibrium occurs because the amount of drug taken into the body is the same as the amount filtered prior to taking the next tablet.</p>

        <p>Suppose the drug Joan is taking has a therapeutic level of 450 mg.  This means that there must be at least 450 milligrams of the drug in her body for Joan to receive the benefits of the drug.  No wonder she thought the drug was not working.  It wasn’t!</p>
      </statement>
    </solution>
  </example>

  <exercises>
    <exercise>
      <statement>
        <p>Modify the recursive  system  used in <xref ref="ibuprofen-example-one-dose" text="type-local"/> as appropriate to answer the following questions:
          <ol>
            <li>Suppose Joan takes tablets that contain 250 milligrams of ibuprofen.  How much ibuprofen would be in her body after 4, 8, 12, 16, 20, and 24 hours? </li>
            <li>Suppose Joan’s kidneys filter only <m>50\%</m> of the drug in a four hour time period.  If Joan takes a 200 mg tablet every 4 hours, how much ibuprofen would she  have in her system after  4, 8, 12, 16, 20 and 24 hours?</li>
          </ol>
        </p>
      </statement>
    </exercise>

    <exercise>
      <statement>
        <p>If Joan takes her medication every 4 hours, determine the amount of drug in Joan’s body after 2 days (twelve  4-hour time periods) and the equilibrium level resulting from each of the following recursive systems.  Plot the ordered pairs you generate on a graph.  Note that in some cases the initial dosage and subsequent doses are not the same size.  In each exercise, the domain of <m>D_n</m> is <m>n=1,2,3, ...</m>
        <ol>
          <li><m>D_0=200, D_n=D_{n-1} - 0.4D_{n-1} + 200</m></li>
          <li><m>D_0=800, D_n=0.6D_{n-1} + 200</m></li>
          <li><m>D_0=600, D_n=0.4D_{n-1} + 200</m></li>
          <li><m>D_0=600, D_n=D_{n-1} - 0.4D_{n-1} + 200</m></li>
          <li><m>D_0=600, D_n=0.6D_{n-1} + 300</m></li>
          <li><m>D_0=600, D_n=0.4D_{n-1} + 300</m></li>
        </ol>
        </p>
      </statement>
    </exercise>

    <exercise>
      <statement>
        <p>Each of the systems in exercise 2 can be written in the form
          <md>
            <mrow>D_0=a</mrow>
            <mrow>D_n=(1-r) D_{n-1}+b, n=1,2,3...</mrow>
          </md>

          <ol>
            <li>What does <m>r</m> represent in the context of Joan's medication?  Why is <m>r</m> between 0 and 1?</li>
            <li>By looking back at the results of exercise 2 and by trying other variations, determine the effect of changing <m>a</m>, <m>r</m>, and <m>b</m> on the amount of drug in Joan's body after 5 days.</li>
            <li>Determine the equilibrium level in terms of <m>a</m>, <m>r</m>, and <m>b</m>.  You can recognize that equilibrium has been reached if  <m>D_n=D_{n-1}</m>.</li>
            <li>Use the result of part c to determine the equilibrium level of a drug if you take 200 mg every 4 hours and your kidneys filter out <m>50\%</m> of the drug in your body every 4 hours.</li>
          </ol>
        </p>
      </statement>
    </exercise>

    <exercise>
      <statement>
        <p>A company has <m>\$10,000</m> worth of equipment and for tax purposes they want to figure the depreciation of the equipment over a 10-year time period.  One method is to reduce the value each year by the same dollar amount.  A second method is to decrease the value of the equipment each year by the same percent of the current value each year.
        <ol>
          <li>Using the first method, generate a table and graph for the value of the equipment if it is  decreased each year by <m>\$2000</m>.</li>
          <li>Using the second method, generate a table and graph for the value of the equipment if it is decreased by <m>20\%</m> each year.</li>
        </ol>
        </p>
      </statement>
    </exercise>

    <exercise>
      <statement>
        <p>One of the primary responsibilities of the manager of a swimming pool is to maintain the proper concentration of chlorine in the swimming pool.  The concentration should be between 1 and 2 parts per million (ppm).  If the concentration gets as high as 3 ppm swimmers experience burning eyes.  If the concentration gets below 1 ppm, the water will become cloudy, which is unappealing.  If it drops below 0.5 ppm, algae begin to grow.  During a period of one day, <m>15\%</m> of the chlorine present in the pool dissipates (mainly due to the sun).
        <ol>
          <li>If the chlorine content starts at 2.5 ppm and no additional chlorine is added, how long will it be before the water becomes cloudy?</li>
          <li>If the chlorine content starts at 2.5 ppm and the equivalent of 0.5 ppm of chlorine is added daily, what will happen to the level of chlorine in the pool in the long run?</li>
          <li>If the chlorine content starts at 2.5 ppm and the equivalent of 0.1 ppm of chlorine is added daily, what will happen to the level of chlorine in the pool in the long run?</li>
          <li>How much chlorine must be added daily for the chlorine level to stabilize at 1.8 ppm?</li>
        </ol>
        </p>
      </statement>
    </exercise>

    <exercise>
      <statement>
        <p>The Fish and Wildlife Division monitors the trout population in a stream that is under their jurisdiction.  Their research indicates that natural predators, together with pollution and fishing, are causing the trout population to decrease at a rate of <m>20\%</m> per month.  They propose to introduce additional trout into the stream each month.  Assume the current population is 300.  Use tables and graphs to investigate the following:
        <ol>
          <li>What will happen to the trout population over the next ten months with no replenishment program?</li>
          <li>What is the long-term result of introducing 100 trout into the stream each month?</li>
          <li>Investigate the result of changing the number of trout introduced each month.  What is the impact on the long-term population of the number of trout added each month?</li>
          <li>Investigate the impact on the long-term behavior of the population of changing the initial population.  What is the effect of the initial population?</li>
          <li>What is the impact of the rate of decrease in the population during the replenishment program?</li>
          <li>There are three parameters in this problem: the initial number of trout, the rate of decrease, and the number of trout added each month. Which parameter seems to have the most influenceon the long-term behavior? Explain briefly.</li>
        </ol>
        </p>
      </statement>
    </exercise>

    <exercise>
      <statement>
        <p>Drugs generally have a therapeutic range rather than a single therapeutic level.  In other words, a drug is effective if the level in the body is between two values.  At concentrations below this range, too little of the drug is present to have a measurable effect, and concentrations above this range may be toxic.  The level of drug in the body peaks just after the drug is taken, while the drug level is at a minimum just before the dosage is taken.  Suppose Joan takes an anti-inflammatory drug at the prescribed dosage of 440 mg every 12 hours and her kidneys filter <m>60\%</m> of the drug from her body every 12 hours.  Use tables and graphs to investigate the following:
        <ol>
          <li>Generate a sequence of values for the level of drug in Joan’s body just before each dose.</li>
          <li>In the long-run, the level of drug in Joan’s body will range  between what two values?</li>
          <li>Suppose the therapeutic range of the anti-inflammatory drug is between 300 mg and 800 mg.  What adjustment, if any, needs to be made in Joan’s dosage to stay within this range in the long run?</li>
        </ol>
        </p>
      </statement>
    </exercise>

    <exercise>
      <statement>
        <p>Suppose Morgan  wants to buy a television that costs <m>\$549</m>.  He has a part-time job, and he is able to save <m>\$85.00</m> each week.  Suppose he accumulates the money at home.
        <ol>
          <li>Write a recursive system that can be used to determine how much Morgan has saved over time.</li>
          <li>Use the recursive system to generate values for the amount of money Morgan has saved in thirteen weeks.</li>
          <li>Make a graph to show the amount Morgan has saved versus the number of weeks he has been saving.</li>
          <li>The points graphed in part (c) should appear linear.  Explain why the situation implies that these ordered pairs are linear.</li>
          <li>Write an explicit function of the form <m>A=f(t)</m> that could be used to generate the same ordered pairs you graphed in part (c).</li>
          <li>State the domain and the range of the explicit function within the context of this problem.  Compare them to the domain and range of the recursively defined function.</li>
        </ol>
        </p>
      </statement>
    </exercise>

    <exercise>
      <statement>
        <p>Now suppose that Morgan deposits his savings in a bank that will pay <m>0.02\%</m> interest each week.
        <ol>
          <li>Write a recursive system that can be used to determine how much Morgan has saved over time.</li>
          <li>Use the recursive system to generate values for the amount of money Morgan has in the bank after 13 weeks of saving.</li>
          <li>Make a graph to show the amount Morgan has saved versus the number of weeks he has been saving.</li>
          <li>Are the ordered pairs graphed in part (c) linear?  Explain why or why not.</li>
          <li>State the domain and range of the recursively defined function.</li>
        </ol>
        </p>
      </statement>
    </exercise>
  </exercises>
</section>
